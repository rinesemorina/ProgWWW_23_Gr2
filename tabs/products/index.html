<div class="products-page-wrapper">
    <div id="filters">
        <!--  Filters are added here    -->
    </div>
    <div id="products-container">
        <div class="header">
            <p class="bold fs-20">All products</p>
            <div class="flex-row">
                <span class="material-symbols-outlined icon mr-10" onclick="toggleShowFilters()">filter_list</span>
                <div class="display-type">
                    <div class="icon-wrapper" onclick="changeDisplayType('grid')">
                        <img id="grid" class="icon" src="../../assets/icons/grid.png" alt="">
                    </div>
                    <div class="icon-wrapper" onclick="changeDisplayType('list')">
                        <img id="list" class="icon" src="../../assets/icons/list.png" alt="">
                    </div>
                </div>
            </div>

        </div>
        <div id="products-list">
            <!-- Product cards will be injected here -->
        </div>
    </div>
</div>

<script>
    let all_data = []
    var all_filters = []
    let showFilters = false

    let display_type = "grid"
    let list = document.getElementById("products-list")
    changeDisplayType()
    getData()

    function getData(){
        fetch('../assets/data/products.json')
            .then((response) => response.json())
            .then((json) => {
                all_data = json
                displayData()
            });
    }
    function displayData(){
        list.innerHTML = ''

        let filteredData = getFilteredData()
        if(filteredData.length === 0){
            list.innerHTML = `<p class="no-data">No data available.</p>`
        }

        filteredData.forEach(item => {
            let item_html = document.createElement('div')
            item_html.className = 'card'
            item_html.innerHTML = `
                <div class="center mb-20">
                    <img class="img" src="${item.images && item.images.length > 0 ? item.images[0] : '../../assets/images/no-img.png'}" alt="">
                </div>
                <div>
                    <p class="bold mb-10">${item.brand} ${item.model}</p>
                    <p class="description">${formattedDescription(item)}</p>
                    <div class="footer">
                        <p class="bold mb-0">${item.price}</p>
                        <p class="more-link fs-14 mb-0" onclick="showDetails('${item.id}')">More Details -></p>
                    </div>
                </div>`

            list.append(item_html)
        })
    }
    function getFilteredData(){
        let data = JSON.parse(JSON.stringify(all_data))

        if(all_filters.length === 0)
            return data

        all_filters.forEach(filter_type => {
            if(filter_type.options.some(item => item.checked)) {
                let checked_options = filter_type.options.filter(i => i.checked).map(i => i.code)
                data = data.filter(opt => checked_options.includes(opt[filter_type.code]))
            }
        })
        return data
    }
    function showDetails(id){
        lastSelectedItem = all_data.find(item => item.id == id)
        $(function(){
            $('#tab-content').load("/tabs/products/details-page.html");
        });
    }
    function changeDisplayType(type){
        display_type = type || display_type || 'products-list'
        let current_active = document.getElementById(display_type)
        current_active.className = current_active.className.replace('active', '')

        let active_item = document.getElementById(type || display_type)
        active_item.className = active_item.className + " " + 'active'

        list.className = display_type + (showFilters && display_type === 'grid' ? ' col-3' : '')
        // displayData()
    }
    function formattedDescription(item){
        return `${item.cpu}, ${item.ram}GB, ${item.space > 1024 ? item.space % 1024 + 'TB' : item.space + 'GB'}, ${item.display}"`
    }

    function toggleShowFilters(){
        showFilters = !showFilters
        if(!showFilters){
            document.getElementById('filters').innerHTML = ''
        }else{
            navigateTo('#filters', 'tabs/products/filters.html')
        }
        displayData()
        changeDisplayType()
    }
</script>